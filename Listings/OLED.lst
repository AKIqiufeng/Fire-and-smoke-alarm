C51 COMPILER V9.54   OLED                                                                  02/03/2024 21:52:10 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\OLED.obj
COMPILER INVOKED BY: D:\software\keil5\C51\BIN\C51.EXE OLED.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\OLED.lst) TABS(2) OBJECT(.\Objects\OLED.obj)

line level    source

   1          
   2          #include "OLED.h"
   3          #include "OLEDFont.h"
   4          
   5          
   6          /***OLED12864/0.96'/SSD1306***/
   7          
   8          /**
   9           * @description: 51å»¶æ—¶å‡½æ•° @11.0592MHz
  10           * @param {uint ms æ¯«ç§’} 
  11           * @return: void
  12           */
  13          void Delay_ms(uint ms)
  14          {
  15   1          uint j;
  16   1          for (ms; ms > 0; ms--)
  17   1              for (j = 112; j > 0; j--);
  18   1      }
  19          
  20          /**
  21           * @function: void OLED_Write_Byte(uchar WCommand,uchar cmdORdata)
  22           * @description: 
  23           * @param {uchar WDataå¾…å†™å…¥çš„å†…å®¹ï¼Œuchar cmdORdataæŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®} 
  24           * @return: void
  25           */
  26          void OLED_Write_Byte(uchar WData, uchar cmdORdata)
  27          {
  28   1          I2C_Start();
  29   1          I2C_Write_Byte(OLED_Addr + 0); //å†™å…¥å™¨ä»¶åœ°å€(bit0=1è¯»ï¼Œbit0=0å†™)
  30   1          I2C_Wait_Ack();
  31   1          I2C_Write_Byte(cmdORdata); //æŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®
  32   1          I2C_Wait_Ack();
  33   1          I2C_Write_Byte(WData); //å†™å…¥æ•°æ®å†…å®¹
  34   1          I2C_Wait_Ack();
  35   1          I2C_Stop();
  36   1      }
  37          
  38          /**
  39           * @function: void OLED_Fill(uchar Fill_Data)
  40           * @description: å…¨å±æ˜¾ç¤ºç›¸åŒæ•°æ®(ä¸»è¦ç”¨å»æ¸…å±)
  41           * @param {uchar Fill_Dataå¾…å…¨å±å†™å…¥çš„æ•°æ®} 
  42           * @return: void
  43           */
  44          void OLED_Fill(uchar Fill_Data)
  45          {
  46   1          uchar i, j;
  47   1          for (i = 0; i < 8; i++) //8é¡µï¼Œå…±éœ€è¦å¾ªç¯æ˜¾ç¤º8æ¬¡
  48   1          {
  49   2              OLED_Write_Byte(0xb0 + i, isCmd); //é¡µåœ°å€0~7
  50   2              OLED_Write_Byte(0x10, isCmd);     //è®¾ç½®é«˜ä½åˆ—åœ°å€
  51   2              OLED_Write_Byte(0x00, isCmd);     //è®¾ç½®ä½ä½åˆ—åœ°å€
  52   2              for (j = 0; j < OLED_Width; j++)  //æ¯é¡µæœ‰128åˆ—éœ€è¦æ˜¾ç¤º
  53   2                  OLED_Write_Byte(Fill_Data, isData);
  54   2          }
C51 COMPILER V9.54   OLED                                                                  02/03/2024 21:52:10 PAGE 2   

  55   1      }
  56          
  57          /**
  58           * @function: void OLED_LocalFill(uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFill)
  59           * @description: å±€éƒ¨å†™ç›¸åŒæ•°æ®(ä¸»è¦ç”¨äºå±€éƒ¨æ¸…å±/äº®å±)
  60           * @param {uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFillï¼Œæ˜¾ç¤ºèµ·å§‹å’Œç»“æŸåæ ‡ï¼Œå†™å…¥æ
             -•°æ®} 
  61           * @return: void
  62           */
  63          #if 0
              void OLED_LocalFill(uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFill)
              {
                  uchar i, j;
                  for (i = y0; i <= y1; i++)
                  {
                      OLED_Set_Pos(x0, i);
                      for (j = x0; j < x1; j++)
                          OLED_Write_Byte(Fill_Data, isData);
                  }
              }
              #endif
  75          
  76          /**
  77           * @function: void OLED_Set_Pos(uchar x,uchar y)
  78           * @description: è®¾ç½®èµ·å§‹æ˜¾ç¤ºä½ç½®
  79           * @param {uchar xèµ·å§‹æ˜¾ç¤ºåˆ—0~127ã€uchar yèµ·å§‹æ˜¾ç¤ºé¡µ0~7} 
  80           * @return: void
  81           */
  82          void OLED_Set_Pos(uchar x, uchar y)
  83          {
  84   1          OLED_Write_Byte(0xb0 + y, isCmd);               //èµ·å§‹æ˜¾ç¤ºçš„é¡µ
  85   1          OLED_Write_Byte((x & 0xf0) >> 4 | 0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€
  86   1          OLED_Write_Byte(x & 0x0f, isCmd);               //è®¾ç½®ä½ä½åˆ—åœ°å€
  87   1      }
  88          
  89          /**
  90           * @function: void OLED_Init()
  91           * @description: OLEDåˆå§‹åŒ–å‡½æ•°
  92           * @param {void} 
  93           * @return: void
  94           */
  95          void OLED_Init()
  96          {
  97   1          Delay_ms(200);
  98   1          OLED_Write_Byte(0xae, isCmd); //å…³é—­æ˜¾ç¤ºå™¨ display off
  99   1          OLED_Write_Byte(0x00, isCmd); //è®¾ç½®ä½ä½åˆ—åœ°å€ set low column address
 100   1          OLED_Write_Byte(0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€ set high column address
 101   1          OLED_Write_Byte(0x40, isCmd); //è®¾ç½®èµ·å§‹è¡Œåœ°å€ set start line address
 102   1          OLED_Write_Byte(0xb0, isCmd); //è®¾ç½®é¡µåœ°å€ set page address
 103   1          OLED_Write_Byte(0x81, isCmd); //è®¾ç½®å¯¹æ¯”åº¦
 104   1          OLED_Write_Byte(0xff, isCmd); //å¯¹æ¯”åº¦,æ•°å€¼è¶Šå¤§å¯¹æ¯”åº¦è¶Šé«˜
 105   1          OLED_Write_Byte(0xa1, isCmd); //è®¾ç½®æ®µé‡æ–°æ˜ å°„ ä¸å·¦å³ç¿»è½¬set segment remap
 106   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ­£å¸¸/åå‘ normal / reverse
 107   1          OLED_Write_Byte(0xa8, isCmd); //è®¾ç½®å¤šè·¯å¤ç”¨æ¯”(1-64) set multiplex ratio(1 to 64)
 108   1          OLED_Write_Byte(0x3f, isCmd); //è®¾å®šå€¼1/32  1/32 duty
 109   1          OLED_Write_Byte(0xc8, isCmd); //æ‰«ææ–¹å‘ ä¸ä¸Šä¸‹ç¿»è½¬Com scan direction
 110   1      
 111   1          OLED_Write_Byte(0xd3, isCmd); //è®¾ç½®æ˜¾ç¤ºåç§» set display offset
 112   1          OLED_Write_Byte(0x00, isCmd); //
 113   1      
 114   1          OLED_Write_Byte(0xd5, isCmd); //è®¾ç½®oscåˆ†åŒº set osc division
 115   1          OLED_Write_Byte(0x80, isCmd); //
C51 COMPILER V9.54   OLED                                                                  02/03/2024 21:52:10 PAGE 3   

 116   1      
 117   1          OLED_Write_Byte(0xd8, isCmd); //å…³é—­åŒºåŸŸé¢œè‰²æ¨¡å¼ set area color mode off
 118   1          OLED_Write_Byte(0x05, isCmd); //
 119   1      
 120   1          OLED_Write_Byte(0xd9, isCmd); //è®¾ç½®é¢„å……ç”µæœŸ Set Pre-Charge Period
 121   1          OLED_Write_Byte(0xf1, isCmd); //
 122   1      
 123   1          OLED_Write_Byte(0xda, isCmd); //è®¾ç½®comå¼•è„šé…ç½® set com pin configuartion
 124   1          OLED_Write_Byte(0x12, isCmd); //
 125   1      
 126   1          OLED_Write_Byte(0xdb, isCmd); //è®¾ç½®vcomh set Vcomh
 127   1          OLED_Write_Byte(0x30, isCmd); //
 128   1      
 129   1          OLED_Write_Byte(0x8d, isCmd); //è®¾ç½®ç”µæºæ³µå¯ç”¨ set charge pump enable
 130   1          OLED_Write_Byte(0x14, isCmd); //
 131   1      
 132   1          OLED_Write_Byte(0xa4, isCmd); //è®¾ç½®å…¨å±€æ˜¾ç¤ºå¼€å¯ï¼›bit0ï¼Œ1å¼€å¯ï¼Œ0å…³é—­(ç™½å±/é»‘å±)
 133   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ˜¾ç¤ºæ–¹å¼ï¼Œbit0ï¼Œ1åç›¸æ˜¾ç¤ºï¼Œ0æ­£å¸¸æ˜¾ç¤º
 134   1      
 135   1          OLED_Write_Byte(0xaf, isCmd); //æ‰“å¼€oledé¢æ¿ turn on oled panel
 136   1      
 137   1          OLED_Fill(0x00); //æ¸…å±
 138   1      }
 139          
 140          /**
 141           * @function: void OLED_DisplayChar(uchar x, uchar y, uchar DisplayChar, uchar TextSize)
 142           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
 143           * @param {uchar xåˆ—, uchar yè¡Œ, uchar DisplayCharæ˜¾ç¤ºçš„å­—ç¬¦, uchar TextSizeå­—ä½“å¤§å°} 
 144           * @return: void
 145           */
 146          void OLED_DisplayChar(uchar x, uchar y, uchar DisplayChar, uchar TextSize)
 147          {
 148   1          uchar c = 0, i;
 149   1          c = DisplayChar - ' '; //ç­‰åŒäºå‡å»ä¸ªç©ºæ ¼c = DisplayChar - ' '; å¾—åˆ°æ˜¾ç¤ºå­—ç¬¦åœ¨åº“ä¸­çš„
             -åç§»åœ°å€
 150   1          switch (TextSize)
 151   1          {
 152   2          case 1:
 153   2              OLED_Set_Pos(x, y); //å¼€å§‹æ˜¾ç¤ºä½ç½®
 154   2              for (i = 0; i < 6; i++)
 155   2                  OLED_Write_Byte(F6X8[c][i], isData); //æ˜¾ç¤ºä¸€ä¸ª6X8å­—ç¬¦
 156   2              break;
 157   2          case 2:
 158   2              OLED_Set_Pos(x, y);                                 //å¼€å§‹æ˜¾ç¤ºä½ç½®
 159   2              for (i = 0; i < 8; i++)                             //æ˜¾ç¤ºä¸€ä¸ª8X16å­—ç¬¦çš„ä¸ŠåŠéƒ¨åˆ†
 160   2                  OLED_Write_Byte(F8X16[c * 16 + i], isData);     //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å‰8ä¸ªæ•°æ®
 161   2              OLED_Set_Pos(x, y + 1);                             //æ¢åˆ°ä¸‹ä¸€é¡µï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸‹åŠéƒ¨åˆ†
 162   2              for (i = 0; i < 8; i++)                             //æ˜¾ç¤º8X16å­—ç¬¦çš„ä¸‹åŠéƒ¨åˆ†
 163   2                  OLED_Write_Byte(F8X16[c * 16 + i + 8], isData); //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å8ä¸ªæ•°æ®
 164   2              break;
 165   2          }
 166   1      }
 167          
 168          /**
 169           * @function: void OLED_DisplayStr(uchar x, uchar y, uchar *DisplayStr, uchar TextSize)
 170           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²
 171           * @param {uchar xåˆ—, uchar yè¡Œ, uchar *DisplayStrå¾…æ˜¾ç¤ºçš„å­—ç¬¦ä¸², uchar TextSizeå­—ä½“å¤§å°} 
 172           * @return: void
 173           */
 174          void OLED_DisplayStr(uchar x, uchar y, uchar *DisplayStr, uchar TextSize) //(uchar *DisplayStr)æ”¹æˆ(ucha
             -r DisplayStr[])ä¹Ÿå¯
 175          {
C51 COMPILER V9.54   OLED                                                                  02/03/2024 21:52:10 PAGE 4   

 176   1          uchar j = 0;
 177   1          while (DisplayStr[j] != '\0') //åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¾ç¤ºå®Œæˆ
 178   1          {
 179   2              OLED_DisplayChar(x, y, DisplayStr[j], TextSize);
 180   2              if (TextSize == 1) //6X8çš„å­—ä½“åˆ—åŠ 6ï¼Œæ˜¾ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦
 181   2                  x += 6;
 182   2              else if (TextSize == 2) //8X16çš„å­—ä½“åˆ—åŠ 8ï¼Œæ˜¾ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦
 183   2                  x += 8;
 184   2      
 185   2              if (x > 122 && TextSize == 1) //TextSize6x8å¦‚æœä¸€è¡Œä¸å¤Ÿæ˜¾ç¤ºäº†ï¼Œä»ä¸‹ä¸€è¡Œç»§ç»­æ˜¾ç¤º
 186   2              {
 187   3                  x = 0;
 188   3                  y++;
 189   3              }
 190   2              if (x > 120 && TextSize == 2) //TextSize8x16å¦‚æœä¸€è¡Œä¸å¤Ÿæ˜¾ç¤ºäº†ï¼Œä»ä¸‹ä¸€è¡Œç»§ç»­æ˜¾ç¤º
 191   2              {
 192   3                  x = 0;
 193   3                  y++;
 194   3              }
 195   2              j++;
 196   2          }
 197   1      }
 198          
 199          /**
 200           * @function: void OLED_DisplayCN(uchar x, uchar y, uchar Num)
 201           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤º16X16æ±‰å­—
 202           * @param {uchar xåˆ—, uchar yè¡Œ, uchar Noæ±‰å­—åº“ä¸­æ±‰å­—ç¼–å·} 
 203           * @return: void
 204           */
 205          void OLED_DisplayCN(uchar x, uchar y, uchar Num)
 206          {
 207   1        uchar i;
 208   1        OLED_Set_Pos(x, y);
 209   1        for (i = 0; i < 16; i++)
 210   1          OLED_Write_Byte(FontCN[2 * Num][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸ŠåŠéƒ¨åˆ†
 211   1        OLED_Set_Pos(x, y + 1);
 212   1        for (i = 0; i < 16; i++)
 213   1          OLED_Write_Byte(FontCN[2 * Num + 1][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸‹åŠéƒ¨åˆ†
 214   1      }
 215          
 216          /**
 217           * @function: void OLED_DisplayBMP(uchar x0, uchar y0, uchar x1, uchar y1, uchar *BMP)
 218           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºBMPå›¾ç‰‡
 219           * @param {uchar x0,uchar y0(x0,y0æ˜¾ç¤ºèµ·ç‚¹åæ ‡x:0~127,y0:0~7)ã€uchar x1,uchar y1(x1,y1æ˜¾ç¤ºç»“æŸå
             -æ ‡x0:0~127,y0:0~7)ã€uchar *BMPå¾…æ˜¾ç¤ºçš„å›¾ç‰‡æ•°æ®} 
 220           * @return: void
 221           */
 222          #if 0
              void OLED_DisplayBMP(uchar x0, uchar y0, uchar x1, uchar y1, uchar *BMP)
              {
                  uint j = 0;
                  uchar x, y;
                  if (y1 % 8 == 0) //ç”¨äºç¡®å®šæ˜¾ç¤ºå‡ é¡µ
                      y = y1 / 8;
                  else
                      y = y1 / 8 + 1;
                  for (y = y0; y < y1; y++) //ä»è®¾ç½®çš„èµ·å§‹é¡µå¼€å§‹æ˜¾ç¤ºåˆ°ç»“æŸé¡µ
                  {
                      OLED_Set_Pos(x0, y);                   //è¿›å…¥ä¸‹ä¸€é¡µæ˜¾ç¤ºèµ·å§‹ä½ç½®
                      for (x = x0; x < x1; x++)              //ä»è®¾ç½®å¼€å§‹åˆ—æ˜¾ç¤ºåˆ°ç»“æŸåˆ—
                          OLED_Write_Byte(BMP[j++], isData); //é€ä¸ªä¼ å…¥æ˜¾ç¤ºæ•°æ®
                  }
C51 COMPILER V9.54   OLED                                                                  02/03/2024 21:52:10 PAGE 5   

              }
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    729    ----
   CONSTANT SIZE    =   3224    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
